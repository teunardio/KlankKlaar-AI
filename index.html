<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KlankKlaar AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Lato', sans-serif;
      text-align: center;
      background-color: #6a0dad; /* Purple background */
      color: white;
      margin: 0;
      padding: 0;
    }

    .player-container {
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #3e2723; /* Dark wood color */
      border-radius: 15px;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5);
      text-align: center;
    }

    .radio-display {
      background: #212121; /* Radio screen color */
      border: 5px solid #ffd700; /* Gold border */
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 20px;
    }

    .radio-display img {
      max-width: 100%;
      border-radius: 10px;
    }

    .track-info {
      font-family: 'Playfair Display', serif;
      font-size: 1.2rem;
      color: #ffd700; /* Gold text */
      margin-top: 10px;
    }

    .controls {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 20px 0;
    }

    .control-button {
      background: #ffd700; /* Gold color */
      border: 3px solid #3e2723;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 1.5rem;
      font-weight: bold;
      color: #3e2723;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .control-button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
    }

    .progress-bar-container {
      margin: 10px auto;
      width: 100%;
      background: #ffd700; /* Gold track */
      height: 10px;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-bar {
      width: 0;
      height: 100%;
      background: #3e2723; /* Dark wood color for progress */
      transition: width 0.1s linear;
    }

    .shuffle-toggle {
      font-size: 0.9rem;
      margin-top: 10px;
      text-decoration: underline;
      cursor: pointer;
      color: #ffd700; /* Gold text */
    }
  </style>
</head>
<body>
  <div class="player-container">
    <div class="radio-display">
      <img src="cover.png" alt="Album Cover" id="album-cover">
    </div>
    <p class="track-info" id="track-title">No track playing</p>
    <div class="controls">
      <button class="control-button" onclick="playPrevious()">⏮</button>
      <button class="control-button" onclick="togglePlayPause()">⏯</button>
      <button class="control-button" onclick="playNext()">⏭</button>
    </div>
    <div class="progress-bar-container">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <p class="shuffle-toggle" onclick="toggleShuffle()">Shuffle: <span id="shuffle-status">Uit</span></p>
  </div>

  <script>
    const tracks = [
      { title: "Christmas Cheers (Raise Your Glass)", file: "Christmas Cheers (Raise Your Glass).mp3" },
      { title: "Maarten's Christmas Lights", file: "Maarten's Christmas Lights.mp3" },
      { title: "Christmas in Old Kampen", file: "Christmas in Old Kampen.mp3" },
      { title: "Xmas at Slijterij Post", file: "Xmas at Slijterij Post.mp3" },
      { title: "Winter Storms", file: "Winter Storms.mp3" },
      { title: "Across the frozen IJssel", file: "Accross the frozen IJssel.mp3" },
      { title: "Drunk at the Christmas Market", file: "Drunk at the Christmas Market.mp3" },
      { title: "Whisky Dreams", file: "Whisky Dreams.mp3" },
      { title: "Magic Beers", file: "Magic Beers.mp3" },
      { title: "Wine & Riffs", file: "Wine & Riffs.mp3" },
      { title: "From the Barn to the Kettle", file: "From the Barn to the Kettle.mp3" },
      { title: "(D)rum", file: "(D)rum.mp3" },
      { title: "Winter Cheer", file: "Winter Cheer.mp3" },
      { title: "Santa's Liquor Run", file: "Santa's Liquor Run.mp3" },
      { title: "Christmas Waltz with You", file: "Christmas Waltz with You.mp3" }
    ];
  
    let currentTrack = 0;
    let shuffle = false;
  
    const audio = new Audio();
    const trackTitle = document.getElementById('track-title');
    const albumCover = document.getElementById('album-cover');
    const progressBar = document.getElementById('progress-bar');
    const shuffleStatus = document.getElementById('shuffle-status');
    let fadeDuration = 5; // Duration of fade-in/out in seconds
  
    function updateMediaSessionMetadata(track) {
      if ('mediaSession' in navigator) {
        navigator.mediaSession.metadata = new MediaMetadata({
          title: track.title,
          artist: "KlankKlaar AI",
          album: "Jouw persoonlijke radiostation",
          artwork: [
            { src: getAlbumArt(track), sizes: "300x300", type: "image/jpeg" },
            { src: getAlbumArt(track), sizes: "512x512", type: "image/jpeg" }
          ]
        });
        navigator.mediaSession.setActionHandler('play', () => audio.play());
        navigator.mediaSession.setActionHandler('pause', () => audio.pause());
        navigator.mediaSession.setActionHandler('previoustrack', playPrevious);
        navigator.mediaSession.setActionHandler('nexttrack', playNext);
      }
    }
  
    function getAlbumArt(track) {
      const jpegCover = track.file.replace('.mp3', '.jpeg');
      return jpegCover;
    }
  
    function loadTrack(index) {
      const track = tracks[index];
      currentTrack = index;
      trackTitle.textContent = track.title;
      audio.src = track.file;
      albumCover.src = getAlbumArt(track);
      albumCover.onerror = () => (albumCover.src = "cover.png");
      updateMediaSessionMetadata(track);
    }
  
    function fadeOut(callback) {
      let volume = audio.volume;
      const interval = 50; // 50ms for smooth fade
      const step = volume / (fadeDuration * 1000 / interval); // Calculate step based on fade duration
  
      const fadeInterval = setInterval(() => {
        if (volume > 0) {
          volume -= step;
          audio.volume = Math.max(volume, 0);
        } else {
          clearInterval(fadeInterval);
          callback(); // Execute the callback (e.g., load the next track)
        }
      }, interval);
    }
  
    function fadeIn() {
      audio.volume = 0;
      let volume = 0;
      const interval = 50; // 50ms for smooth fade
      const step = 1 / (fadeDuration * 1000 / interval); // Calculate step based on fade duration
  
      const fadeInterval = setInterval(() => {
        if (volume < 1) {
          volume += step;
          audio.volume = Math.min(volume, 1);
        } else {
          clearInterval(fadeInterval);
        }
      }, interval);
    }
  
    function playPrevious() {
      fadeOut(() => {
        currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
        loadTrack(currentTrack);
        audio.play();
        fadeIn();
      });
    }
  
    function playNext() {
      fadeOut(() => {
        currentTrack = shuffle
          ? Math.floor(Math.random() * tracks.length)
          : (currentTrack + 1) % tracks.length;
        loadTrack(currentTrack);
        audio.play();
        fadeIn();
      });
    }
  
    function togglePlayPause() {
      if (audio.paused) {
        audio.play();
        fadeIn();
      } else {
        fadeOut(() => audio.pause());
      }
    }
  
    function toggleShuffle() {
      shuffle = !shuffle;
      shuffleStatus.textContent = shuffle ? "Aan" : "Uit";
    }
  
    audio.addEventListener('timeupdate', () => {
      const progress = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = `${progress}%`;
    });
  
    audio.addEventListener('ended', playNext);
  
    loadTrack(0);
  </script>
</body>
</html>